+function(){function x(b,c){var e,d=a;if(c)for(var f=0;f<a.length;f++)if(a[f].categoryName==c){d=a[f].childCategories;break}if(b)for(var f=0;f<d.length;f++)if(d[f].categoryName==b){e=d[f];break}return e}function y(a,b){function d(a,b){var c=Number(a.date.replace(/-/g,"")),d=Number(b.date.replace(/-/g,""));return c-d}var c=x(a,b).tasks;c.sort(d);var e=document.getElementsByClassName("task-list")[0];e.setAttribute("cateName",a),b?e.setAttribute("parentCateName",b):e.setAttribute("parentCateName",""),e.innerHTML="";for(var f=0;f<c.length;f++){var g=document.createElement("li"),h=document.createElement("h4");h.innerHTML=c[f].date,g.appendChild(h);for(var i=0;i<c[f].task.length;i++){var j=document.createElement("li");j.innerHTML=c[f].task[i].name,j.className="task "+c[f].task[i].status,g.appendChild(j)}e.appendChild(g)}}function z(b,d){c.innerHTML="";for(var e=0;e<a.length;e++){var f=document.createElement("li");cateA=a[e];var g=document.createElement("h4");g.innerHTML='<span class="fa fa-folder"></span> '+cateA.categoryName+"("+cateA.childrenNum+') <span class="close fa fa-times"></span>';var h=document.createElement("ul");cateA.categoryName==(d||b)&&(g.className="active",h.className="show");for(var i=0;i<cateA.childCategories.length;i++){var j=document.createElement("li"),k=cateA.childCategories[i];k.categoryName==b&&(j.className="active"),j.innerHTML='<span class="fa fa-file-o"></span> '+k.categoryName+"("+k.childrenNum+') <span class="close fa fa-times"></span>',h.appendChild(j)}f.appendChild(g),f.appendChild(h),c.appendChild(f)}}function A(a,b){for(var c,d,e=0;e<b.length;e++){for(var f=0;f<b[e].task.length;f++)if(b[e].task[f].name===a){d=b[e].date,c=b[e].task[f];break}if(c)break}return[c,d]}function B(a,b,c){for(var d=x(b,c).tasks,f=0;f<d.length;f++)if(J(d[f].date,a))return d[f].task;return void 0}function C(a,b,c){var d=x(b,c).tasks,e=A(a,d),f=e[0],g=e[1],h=document.getElementsByClassName("details")[0],i=h.getElementsByTagName("h4")[0],j=h.getElementsByClassName("date")[0],k=h.getElementsByClassName("detail")[0];i.innerHTML=f.name||"",j.innerHTML=g||"",k.innerHTML=f.detail||""}function D(a){var b=a.parentNode.previousElementSibling;return"h4"==b.nodeName.toLowerCase()?b.innerText.trim():void 0}function E(a){var b=a.split("(");return b.splice(b.length-1),b.toString().trim()}function F(b,c){var f,g,e=a;if(c)for(var h=0;h<a.length;h++)if(a[h].categoryName==c){e=a[h].childCategories,f=h;break}if(b)for(var h=0;h<e.length;h++)if(e[h].categoryName==b){g=h;break}return[g,f]}function G(b,c){var d=F(b,c),e=a;if("number"==(typeof d[1]).toLowerCase()){e=a[d[1]];var f=e.childCategories;f.splice(d[0],1),e.tasks=[];for(var g=0;g<f.length;g++)e.tasks=e.tasks.concat(f[g].tasks)}else a.splice(d[0],1)}function H(b,c){var d=a;c?(d=x(c),d.childCategories[d.childCategories.length]={categoryName:b,childrenNum:0,tasks:[]}):d[d.length]={categoryName:b,childrenNum:0,childCategories:[],tasks:[]}}function I(a,b,c,d){var e=x(c,d);if(d){for(var f=0;f<e.tasks.length;f++)if(J(b,e.tasks[f].date)){var g=e.tasks[f].task;return void(g[g.length]={name:a,status:"uncomplete",detail:""})}e.tasks[e.tasks.length]={date:b,task:[{name:a,status:"uncomplete",detail:""}]}}else{e.childCategories[0]||(e.childCategories[0]={categoryName:"\u5b50\u5206\u7c7b1",childrenNum:"0",tasks:[]}),e=e.childCategories[0];for(var f=0;f<e.tasks.length;f++)if(J(b,e.tasks[f].date)){var g=e.tasks[f].task;return void(g[g.length]={name:a,status:"uncomplete",detail:""})}e.tasks[e.tasks.length]={date:b,task:[{name:a,status:"uncomplete",detail:""}]}}}function J(a,b){a=a.split("-"),b=b.split("-");for(var c=0;3>c;c++)if(Number(a[c])!=Number(b[c]))return!1;return!0}function K(a,b,c,d,e){var f=x(d,e);if(e)for(var g=0;g<f.tasks.length;g++){var h=f.tasks[g];if(J(h.date,c))for(var i=0;i<h.task.length;i++)if(h.task[i].name==b){if("complete"==h.task[i].status)return void(confirm("\u4efb\u52a1\uff1a"+b+"\u5df2\u5b8c\u6210\uff01\u70b9\u51fb\u786e\u5b9a\u8bbe\u7f6e\u4e3a\uff1a\u672a\u5b8c\u6210")&&(h.task[i].status="uncomplete"));if("uncomplete"==h.task[i].status)return void(confirm("\u786e\u5b9a\u5df2\u5b8c\u6210\u4efb\u52a1\uff1a"+b+"\uff01")&&(h.task[i].status="complete"))}}else for(var g=0;g<f.childCategories.length;g++)for(var j=f.childCategories[g],i=0;i<j.tasks.length;i++){var k=j.tasks[i];if(J(k.date,c))for(var l=0;l<k.task.length;l++)if(k.task[l].name==b){if("complete"==k.task[l].status)return void(confirm("\u4efb\u52a1\uff1a"+b+"\u5df2\u5b8c\u6210\uff01\u70b9\u51fb\u786e\u5b9a\u8bbe\u7f6e\u4e3a\uff1a\u672a\u5b8c\u6210")&&(k.task[l].status="uncomplete"));if("uncomplete"==k.task[l].status)return void(confirm("\u786e\u5b9a\u5df2\u5b8c\u6210\u4efb\u52a1\uff1a"+b+"\uff01")&&(k.task[l].status="complete"))}}}function L(a){for(var b=x(a),c=[],d=0,e=0;e<b.childCategories.length;e++){for(var f=0,g=0;g<b.childCategories[e].tasks.length;g++)c[c.length]=b.childCategories[e].tasks[g],f+=b.childCategories[e].tasks[g].task.length;b.childCategories[e].childrenNum=f,d+=f}b.tasks=c,b.childrenNum=d}function M(){localStorage.setItem("GTDTasks",JSON.stringify(a))}function N(){return JSON.parse(localStorage.getItem("GTDTasks"))}var a;a=N();var b=document.getElementsByClassName("categories")[0],c=document.getElementsByClassName("category")[0];if(a){a||(a={categoryName:"\u9ed8\u8ba4\u5206\u7c7b",childrenNum:0,childCategories:[],tasks:[]});for(var f=0;f<a.length;f++){var g=document.createElement("li");0==f&&(g.className="active"),cateA=a[f];var h=document.createElement("h4");h.innerHTML='<span class="fa fa-folder"></span> '+cateA.categoryName+"("+cateA.childrenNum+') <span class="close fa fa-times"></span>';for(var i=document.createElement("ul"),j=0;j<cateA.childCategories.length;j++){var k=document.createElement("li"),l=cateA.childCategories[j];k.innerHTML='<span class="fa fa-file-o"></span> '+l.categoryName+"("+l.childrenNum+') <span class="close fa fa-times"></span>',i.appendChild(k)}g.appendChild(h),g.appendChild(i),c.appendChild(g)}y(a[0].categoryName),C(a[0].tasks[0].task[0].name,a[0].categoryName)}else{var d="http://suen427.github.io/works/works/GTD/gtd.json",e=new XMLHttpRequest;e.open("get",d),e.send(),e.onreadystatechange=function(){if(4==e.readyState){a=JSON.parse(e.responseText).categories,a||(a={categoryName:"\u9ed8\u8ba4\u5206\u7c7b",childrenNum:0,childCategories:[],tasks:[]});for(var b=0;b<a.length;b++){var d=document.createElement("li");0==b&&(d.className="active"),cateA=a[b];var f=document.createElement("h4");f.innerHTML='<span class="fa fa-folder"></span> '+cateA.categoryName+"("+cateA.childrenNum+') <span class="close fa fa-times"></span>';for(var g=document.createElement("ul"),h=0;h<cateA.childCategories.length;h++){var i=document.createElement("li"),j=cateA.childCategories[h];i.innerHTML='<span class="fa fa-file-o"></span> '+j.categoryName+"("+j.childrenNum+') <span class="close fa fa-times"></span>',g.appendChild(i)}d.appendChild(f),d.appendChild(g),c.appendChild(d)}y(a[0].categoryName),C(a[0].tasks[0].task[0].name,a[0].categoryName)}}}b.addEventListener("click",function(c){var d=c.target;if(d.className.indexOf("close")>-1){var e=d.parentNode;if(e.id.indexOf("default")>-1||e.parentNode.previousElementSibling&&e.parentNode.previousElementSibling.id.indexOf("default")>-1)return void alert("\u4e0d\u80fd\u4fee\u6539\u9ed8\u8ba4\u5206\u7c7b\uff01");if(confirm("\u786e\u5b9a\u5220\u9664\u5206\u7c7b\uff1a"+d.parentNode.innerText)){if("li"==d.parentNode.nodeName.toLowerCase()){var f=d.parentNode,g=E(f.innerText),h=E(D(f));return G(g,h),d.parentNode.parentNode.removeChild(d.parentNode),y(a[0].categoryName),C(a[0].tasks[0].task[0].name,a[0].categoryName),void L(h)}if("h4"==d.parentNode.nodeName.toLowerCase()){var f=d.parentNode,g=E(f.innerText);return G(g,h),d.parentNode.parentNode.parentNode.removeChild(d.parentNode.parentNode),y(a[0].categoryName),void C(a[0].tasks[0].task[0].name,a[0].categoryName)}}}var i=b.getElementsByClassName("active")[0];b.getElementsByClassName("show")[0];if("h4"==d.nodeName.toLowerCase()||"li"==d.nodeName.toLowerCase()||"h3"==d.nodeName.toLowerCase()||d.className.indexOf("fa")>-1){d.className.indexOf("fa")>-1&&(d=d.parentNode),i&&(i.className=i.className.replace("active","")),d.className=d.className+" active";var g=d.innerText.split("(")[0].trim();if("li"==d.nodeName.toLowerCase())var h=d.parentNode.previousElementSibling.innerText.split("(")[0].trim();if(y(g,h),d.parentNode.className.indexOf("show")>-1)return;var k=d.parentNode.getElementsByTagName("ul")[0];k.className.indexOf("show")>-1?k.className=k.className.replace("show",""):k.className+=" show"}});var m=document.getElementsByClassName("add-class")[0];m.addEventListener("click",function(a){var c=b.getElementsByClassName("active")[0];if(c.id.indexOf("default")>-1||c.parentNode.previousElementSibling&&c.parentNode.previousElementSibling.id.indexOf("default")>-1)return void alert("\u4e0d\u80fd\u4fee\u6539\u9ed8\u8ba4\u5206\u7c7b\uff01");var d=prompt("\u65b0\u589e\u5206\u7c7b\u540d\uff1a");if(d){var e=document.createElement("li");if("h3"==c.nodeName.toLowerCase()){var f=document.createElement("h4");f.innerHTML='<span class="fa fa-folder"></span> '+d+' <span class="close fa fa-times"></span>';var g=document.createElement("ul");e.appendChild(f),e.appendChild(g);var h=b.getElementsByClassName("category")[0];h.appendChild(e),H(d)}if("h4"==c.nodeName.toLowerCase()){var i=document.createElement("li");i.innerHTML='<span class="fa fa-file-o"></span> '+d+' <span class="close fa fa-times"></span>';var h=c.parentNode.getElementsByTagName("ul")[0];h.appendChild(i),H(d,E(h.previousElementSibling.innerText))}if("li"==c.nodeName.toLowerCase()){var i=document.createElement("li");i.innerHTML='<span class="fa fa-file-o"></span> '+d+' <span class="close fa fa-times"></span>';var h=c.parentNode;h.appendChild(i),H(d,E(h.previousElementSibling.innerText))}}});var n=document.getElementsByClassName("task-header")[0];n.addEventListener("click",function(a){var b=a.target;if("span"==b.nodeName.toLowerCase()){for(var c=n.getElementsByTagName("span"),d=0;d<c.length;d++)c[d].className="";b.className="active",n.parentNode.className="tasks"+("all-task"==b.id?"":" "+b.id)}});var o=document.getElementsByClassName("task-list")[0];o.addEventListener("click",function(a){var b=a.target;if("li"==b.nodeName.toLowerCase()){var c=b.innerText,d=o.getAttribute("cateName"),e=o.getAttribute("parentCateName");null==e&&(e=void 0),C(c,d,e)}});var p=document.getElementsByClassName("add-task")[0],q=document.getElementsByClassName("add-dialog")[0],r=document.getElementById("save"),s=document.getElementById("cancel");p.addEventListener("click",function(a){a.target;q.style.display="block"}),s.addEventListener("click",function(a){a.stopPropagation(),a.preventDefault(),q.style.display="none"}),r.addEventListener("click",function(a){a.stopPropagation(),a.preventDefault();var b=a.target,c=document.getElementById("formAddTask");if("save"==b.id){if(!c.date.value||!c.task.value)return void alert("\u8bf7\u586b\u5199\u65e5\u671f\u4e0e\u5185\u5bb9\uff01");var d=o.getAttribute("cateName"),e=o.getAttribute("parentCateName");e||(e=void 0);var f=c.task.value.trim(),g=c.date.value,h=B(g,d,e);if(h)for(var i=0;i<h.length;i++)if(h[i].name==f)return void alert("\u5df2\u7ecf\u5b58\u5728\u4efb\u52a1\uff1a"+f+"!");var j=document.createElement("li");if(h){tasksH4Date=o.getElementsByTagName("h4");for(var i=0;i<tasksH4Date.length;i++)if(J(tasksH4Date[i].innerHTML.trim(),g)){j=tasksH4Date[i].parentNode;var k=document.createElement("li");k.innerHTML=f,k.className="task",j.appendChild(k)}}else{var l=document.createElement("h4");l.innerHTML=g;var m=document.createElement("ul"),n=document.createElement("li");n.innerHTML=f,n.className="task",m.appendChild(n),o.appendChild(l),o.appendChild(m)}I(f,g,d,e),q.style.display="none",L(e||d),z(d,e),y(d,e)}});var t=document.getElementById("setcomplete"),u=document.getElementById("edit");t.addEventListener("click",function(a){var b=a.target,c=b.parentNode.getElementsByTagName("h4")[0].innerText.trim(),d=document.getElementsByClassName("task-list")[0],e=d.getAttribute("cateName"),f=d.getAttribute("parentCateName"),g=b.parentNode.getElementsByClassName("date")[0].innerText.trim();f||(f=void 0),K("complete",c,g,e,f),L(f||e),y(e,f),C(c,e,f)}),u.addEventListener("click",function(a){var b=a.target,c=document.getElementsByClassName("edit-dialog")[0];c.style.display="block";var d=o.getAttribute("cateName"),e=o.getAttribute("parentCateName");e||(e=void 0);for(var f=b.parentNode.getElementsByTagName("h4")[0].innerText.trim(),g=x(d,e),h=A(f,g.tasks),i=c.getElementsByTagName("form")[0],j=h[1].split("-"),k=1;3>k;k++)j[k]=1==j[k].length?"0"+j[k]:j[k];j=j.join("-"),i.date.value=j,i.date.setAttribute("disabled","disabled"),i.task.value=f,i.task.setAttribute("disabled","disabled"),i.detail.value=h[0].detail});var v=document.getElementById("edit-save"),w=document.getElementById("edit-cancel");w.addEventListener("click",function(a){a.preventDefault(),document.getElementsByClassName("edit-dialog")[0].style.display="none"}),v.addEventListener("click",function(a){a.preventDefault();var c=(a.target,document.getElementsByClassName("edit-dialog")[0]),d=o.getAttribute("cateName"),e=o.getAttribute("parentCateName");e||(e=void 0);var f=document.getElementsByClassName("details")[0].getElementsByTagName("h4")[0].innerText.trim(),g=x(d,e),h=A(f,g.tasks),i=c.getElementsByTagName("form")[0];task=h[0],task.name=i.task.value,task.detail=i.detail.value,c.style.display="none",L(e||d),C(f,d,e)}),setInterval(M,1e4),window.onunload=M}();